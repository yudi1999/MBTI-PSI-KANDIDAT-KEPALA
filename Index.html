<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tes Psikometri - Penilaian Kandidat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-primary:disabled {
            background-color: #a5b4fc;
            cursor: not-allowed;
        }
        .statement-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease-in-out;
        }
        .btn-choice {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .btn-most {
            background-color: #dbeafe; color: #1e40af; border-color: #93c5fd;
        }
        .btn-least {
            background-color: #fee2e2; color: #991b1b; border-color: #fca5a5;
        }
        .btn-choice.selected-most {
             background-color: #1d4ed8; color: white;
        }
        .btn-choice.selected-least {
            background-color: #b91c1c; color: white;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #fff;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="app" class="max-w-4xl w-full mx-auto">

        <!-- Halaman Data Diri -->
        <div id="welcome-page" class="card">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-gray-900">Tes Penilaian Situasional</h1>
                <p class="text-xl text-gray-700 mt-2">untuk Seleksi Kandidat</p>
                <p class="mt-4 text-gray-600">Selamat datang. Tes ini terdiri dari beberapa set pernyataan. Di setiap set, pilih satu pernyataan yang PALING menggambarkan diri Anda dan satu yang PALING TIDAK menggambarkan diri Anda. Hasil tes ini akan membantu kami memahami preferensi dan gaya kerja Anda.</p>
            </div>
            <form id="data-diri-form" class="mt-8 space-y-6">
                <div>
                    <label for="nama" class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
                    <input type="text" id="nama" name="nama" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="email" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                 <div>
                    <label for="posisi" class="block text-sm font-medium text-gray-700">Posisi yang Dilamar</label>
                    <input type="text" id="posisi" name="posisi" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div class="flex items-start">
                    <div class="flex items-center h-5">
                        <input id="persetujuan" name="persetujuan" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                    </div>
                    <div class="ml-3 text-sm">
                        <label for="persetujuan" class="font-medium text-gray-700">Persetujuan</label>
                        <p class="text-gray-500">Saya setuju bahwa data dan hasil tes ini akan disimpan dan digunakan untuk keperluan proses seleksi. Saya memahami bahwa data ini akan dijaga kerahasiaannya.</p>
                    </div>
                </div>
                <div>
                    <button type="submit" id="start-btn" class="w-full flex justify-center btn-primary" disabled>
                        Mulai Tes
                    </button>
                </div>
            </form>
        </div>

        <!-- Halaman Tes -->
        <div id="test-page" class="card hidden">
            <h2 id="question-title" class="text-2xl font-bold text-center">Set Pernyataan 1 dari 20</h2>
             <p class="text-center text-gray-600 mt-2">Pilih satu pernyataan yang **Paling Sesuai** dan satu yang **Paling Tidak Sesuai**.</p>
            <div class="mt-4">
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
            <div id="question-container" class="mt-8">
                <!-- Pertanyaan akan dimuat di sini -->
            </div>
            <div class="mt-6 text-center">
                 <p id="validation-message" class="text-red-500 text-sm mb-4 hidden"></p>
            </div>
            <div class="mt-2 flex justify-between">
                <button id="prev-btn" class="btn-primary" style="background-color: #6b7280;">Sebelumnya</button>
                <button id="next-btn" class="btn-primary">Selanjutnya</button>
                <button id="finish-btn" class="w-full md:w-auto btn-primary hidden flex justify-center items-center">
                    <span id="finish-btn-text">Selesaikan Tes</span>
                    <div id="finish-spinner" class="spinner hidden"></div>
                </button>
            </div>
        </div>

        <!-- Halaman Terima Kasih (Sama seperti sebelumnya) -->
         <div id="thank-you-page" class="card hidden">
            <div class="text-center">
                <svg class="mx-auto h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h2 class="mt-4 text-2xl font-bold text-gray-900">Terima Kasih!</h2>
                <p class="mt-2 text-gray-600">Anda telah menyelesaikan tes. Hasil Anda telah berhasil dikirimkan. Tim rekrutmen akan menghubungi Anda untuk tahap selanjutnya.</p>
            </div>
        </div>

    </div>

    <script>
        // --- Kumpulan Pertanyaan Baru (Format Forced-Choice Agregat) ---
        const questionSets = [
            { set: 1, statements: [ { text: "Saya mudah beradaptasi dengan situasi baru.", trait: "P" }, { text: "Saya memastikan semua detail pekerjaan benar.", trait: "S" }, { text: "Saya suka menganalisis masalah secara mendalam.", trait: "T" }, { text: "Saya menikmati interaksi dengan banyak orang.", trait: "E" } ] },
            { set: 2, statements: [ { text: "Saya lebih suka bekerja sendiri dengan tenang.", trait: "I" }, { text: "Saya membuat keputusan berdasarkan perasaan.", trait: "F" }, { text: "Saya selalu merencanakan pekerjaan saya.", trait: "J" }, { text: "Saya tertarik dengan ide-ide dan konsep baru.", trait: "N" } ] },
            { set: 3, statements: [ { text: "Saya membuat keputusan secara objektif.", trait: "T" }, { text: "Saya energik saat berada di tengah keramaian.", trait: "E" }, { text: "Saya lebih suka pilihan yang fleksibel.", trait: "P" }, { text: "Saya fokus pada fakta dan kenyataan.", trait: "S" } ] },
            { set: 4, statements: [ { text: "Saya mempertimbangkan perasaan orang lain.", trait: "F" }, { text: "Saya melihat gambaran besar dari suatu proyek.", trait: "N" }, { text: "Saya membutuhkan waktu sendiri untuk berpikir.", trait: "I" }, { text: "Saya suka menyelesaikan tugas tepat waktu.", trait: "J" } ] },
            { set: 5, statements: [ { text: "Saya suka mengikuti jadwal yang teratur.", trait: "J" }, { text: "Saya memikirkan kemungkinan-kemungkinan di masa depan.", trait: "N" }, { text: "Saya membutuhkan logika yang jelas untuk yakin.", trait: "T" }, { text: "Saya lebih suka lingkungan kerja yang tenang.", trait: "I" } ] },
            { set: 6, statements: [ { text: "Saya mudah bergaul dengan orang baru.", trait: "E" }, { text: "Saya memperhatikan detail-detail praktis.", trait: "S" }, { text: "Saya menjaga keharmonisan dalam tim.", trait: "F" }, { text: "Saya terbuka terhadap perubahan rencana.", trait: "P" } ] },
            { set: 7, statements: [ { text: "Saya suka ketika semua hal terorganisir.", trait: "J" }, { text: "Saya sering mengandalkan intuisi saya.", trait: "N" }, { text: "Saya lebih suka bekerja dengan data dan fakta.", trait: "S" }, { text: "Saya menjaga jarak emosional saat bekerja.", trait: "T" } ] },
            { set: 8, statements: [ { text: "Saya spontan dan mudah beradaptasi.", trait: "P" }, { text: "Saya berempati dengan rekan kerja saya.", trait: "F" }, { text: "Saya lebih suka mengisi ulang energi sendirian.", trait: "I" }, { text: "Saya adalah pusat perhatian di acara sosial.", trait: "E" } ] },
            { set: 9, statements: [ { text: "Saya menghargai keadilan dan konsistensi.", trait: "T" }, { text: "Saya suka hal-hal yang jelas dan terstruktur.", trait: "J" }, { text: "Saya lebih banyak bicara daripada mendengar.", trait: "E" }, { text: "Saya sering memikirkan makna yang lebih dalam.", trait: "N" } ] },
            { set: 10, statements: [ { text: "Saya peduli pada bagaimana keputusan saya mempengaruhi orang lain.", trait: "F" }, { text: "Saya lebih suka bekerja pada hal-hal yang nyata.", trait: "S" }, { text: "Saya suka membiarkan pilihan saya terbuka.", trait: "P" }, { text: "Saya lebih produktif saat bekerja sendiri.", trait: "I" } ] },
            { set: 11, statements: [ { text: "Saya adalah perencana yang baik.", trait: "J" }, { text: "Saya lebih suka fakta daripada teori.", trait: "S" }, { text: "Saya mudah memulai percakapan.", trait: "E" }, { text: "Saya membuat keputusan berdasarkan logika.", trait: "T" } ] },
            { set: 12, statements: [ { text: "Saya sensitif terhadap kebutuhan orang lain.", trait: "F" }, { text: "Saya suka memikirkan konsep-konsep abstrak.", trait: "N" }, { text: "Saya lebih suka lingkungan yang tidak terduga.", trait: "P" }, { text: "Saya membutuhkan kesendirian untuk memulihkan energi.", trait: "I" } ] },
            { set: 13, statements: [ { text: "Saya memproses informasi secara internal.", trait: "I" }, { text: "Saya menghargai tradisi dan cara yang sudah terbukti.", trait: "S" }, { text: "Saya suka debat intelektual.", trait: "T" }, { text: "Saya suka menyelesaikan pekerjaan jauh-jauh hari.", trait: "J" } ] },
            { set: 14, statements: [ { text: "Saya suka berada di lingkungan yang dinamis dan ramai.", trait: "E" }, { text: "Saya mencari keharmonisan dan persetujuan.", trait: "F" }, { text: "Saya suka mengeksplorasi ide-ide baru.", trait: "N" }, { text: "Saya menunda keputusan untuk melihat opsi lain.", trait: "P" } ] },
            { set: 15, statements: [ { text: "Saya fokus pada detail saat ini.", trait: "S" }, { text: "Saya senang menjadi bagian dari tim yang ramai.", trait: "E" }, { text: "Saya berpegang pada prinsip dan logika.", trait: "T" }, { text: "Saya suka menyelesaikan segala sesuatu.", trait: "J" } ] },
            { set: 16, statements: [ { text: "Saya menikmati keheningan dan privasi.", trait: "I" }, { text: "Saya memikirkan bagaimana hal-hal bisa menjadi lebih baik.", trait: "N" }, { text: "Saya mengutamakan perasaan dalam hubungan.", trait: "F" }, { text: "Saya fleksibel dan tidak suka terikat jadwal.", trait: "P" } ] },
            { set: 17, statements: [ { text: "Saya adalah orang yang teratur dan metodis.", trait: "J" }, { text: "Saya menilai situasi secara objektif.", trait: "T" }, { text: "Saya adalah seorang visioner.", trait: "N" }, { text: "Saya adalah seorang realis.", trait: "S" } ] },
            { set: 18, statements: [ { text: "Saya lebih suka bekerja dengan tenggat waktu yang fleksibel.", trait: "P" }, { text: "Saya suka menyemangati dan mendukung orang lain.", trait: "F" }, { text: "Saya lebih suka memikirkan sesuatu sendiri.", trait: "I" }, { text: "Saya adalah orang yang terbuka dan mudah diajak bicara.", trait: "E" } ] },
            { set: 19, statements: [ { text: "Saya fokus pada apa yang bisa diterapkan.", trait: "S" }, { text: "Saya tertarik pada teori dan pola.", trait: "N" }, { text: "Saya membuat keputusan dengan cepat.", trait: "J" }, { text: "Saya suka menjaga pilihan saya tetap terbuka.", trait: "P" } ] },
            { set: 20, statements: [ { text: "Saya bersikap analitis saat membuat keputusan.", trait: "T" }, { text: "Saya adalah pendengar yang baik.", trait: "I" }, { text: "Saya mudah mengekspresikan diri di depan umum.", trait: "E" }, { text: "Saya mempertimbangkan nilai-nilai pribadi saat memutuskan.", trait: "F" } ] }
        ];

        // Interpretasi hasil (tetap sama)
        const allInterpretations = {
             ISTJ: { description: "Praktis, berorientasi pada fakta, dan sangat bertanggung jawab. Mereka adalah individu yang tertib, teratur, dan dapat diandalkan yang menghargai tradisi dan kesetiaan. Mereka bekerja dengan mantap menuju tujuan mereka, fokus pada detail, dan memastikan semuanya berjalan sesuai rencana dan standar yang ada.", strengths: ["Sangat Terorganisir: Mampu menciptakan dan memelihara ketertiban dalam sistem, inventaris, dan jadwal.", "Teliti dan Detail: Tidak ada detail kecil yang terlewat, sangat baik untuk audit dan kontrol kualitas.", "Berintegritas Tinggi: Jujur, lugas, dan memegang teguh komitmen serta aturan yang berlaku.", "Logika Praktis: Mampu membuat keputusan yang masuk akal berdasarkan fakta dan pengalaman masa lalu."], development: ["Cenderung Kaku: Sulit beradaptasi dengan perubahan mendadak atau cara-cara baru yang belum teruji.", "Kurang Peka pada Emosi: Terkadang bisa terlihat tidak sensitif atau terlalu kritis karena fokus pada logika dan tugas.", "Menyalahkan Diri Sendiri: Cenderung menanggung semua beban dan menyalahkan diri sendiri jika ada yang salah.", "Enggan Menerima Ide Abstrak: Lebih percaya pada apa yang nyata dan terbukti daripada teori atau kemungkinan baru."], leadership: "Sebagai pemimpin, ISTJ adalah manajer yang stabil dan konsisten. Mereka memimpin dengan teladan, menetapkan standar operasional yang jelas, dan memastikan prosedur diikuti dengan cermat. Mereka akan unggul dalam manajemen inventaris, penjadwalan staf, pelaporan keuangan, dan memastikan kepatuhan penuh terhadap standar perusahaan.", profession: "Manajer, Akuntan, Polisi, Hakim, Auditor, System Analyst, Manajer Logistik." }, ISFJ: { description: "Dikenal sebagai 'Sang Pelindung', mereka sangat berdedikasi, hangat, dan bertanggung jawab. ISFJ sangat peka terhadap kebutuhan orang lain dan bekerja tanpa lelah untuk memenuhi kewajiban mereka. Mereka menciptakan lingkungan yang harmonis dan teratur, didorong oleh keinginan kuat untuk melayani.", strengths: ["Sangat Suportif dan Peduli: Sangat baik dalam memahami kebutuhan pelanggan dan staf, menciptakan loyalitas.", "Dapat Diandalkan dan Teliti: Melaksanakan tugas dengan cermat dan memastikan tidak ada yang terlewat.", "Praktis dan Terorganisir: Mampu mengelola operasional harian toko dengan efisien dan rapi.", "Menciptakan Keharmonisan: Berusaha keras untuk menjaga lingkungan kerja yang positif dan kolaboratif."], development: ["Sulit Mengatakan 'Tidak': Mungkin terlalu banyak menanggung beban untuk membantu orang lain, yang bisa menyebabkan keleahan.", "Menghindari Konflik: Cenderung menghindari konfrontasi yang diperlukan untuk menyelesaikan masalah.", "Terlalu Mengambil Hati Kritik: Kritik terhadap pekerjaan mereka bisa dianggap sebagai serangan pribadi.", "Ragu-ragu terhadap Perubahan: Lebih suka metode yang sudah dikenal dan mungkin menolak inovasi."], leadership: "ISFJ memimpin dengan pelayanan. Mereka akan sangat fokus pada kepuasan pelanggan dan kesejahteraan tim. Mereka akan membangun tim yang solid dan setia, serta memastikan setiap pelanggan merasa dihargai. Mereka menciptakan suasana toko yang ramah dan menyambut.", profession: "Perawat, Guru, Administratif, Pekerja Sosial, Manajer Layanan Pelanggan, HR." }, INFJ: { description: "Seorang idealis yang pendiam namun sangat inspiratif dan tak kenal lelah. INFJ memiliki pemahaman yang mendalam tentang motivasi manusia dan didorong oleh visi untuk membuat dunia menjadi tempat yang lebih baik. Mereka kreatif, berprinsip, dan seringkali menjadi agen perubahan.", strengths: ["Visioner dan Inspiratif: Mampu melihat potensi dalam diri orang lain dan menginspirasi tim untuk mencapai tujuan bersama.", "Sangat Berempati: Dapat memahami dan merasakan apa yang dibutuhkan oleh pelanggan dan staf pada tingkat yang lebih dalam.", "Tegas dan Berprinsip: Berpegang teguh pada nilai-nilai dan dapat membuat keputusan sulit demi kebaikan yang lebih besar.", "Kreatif dalam Memecahkan Masalah: Menemukan solusi inovatif untuk tantangan yang kompleks."], development: ["Bisa Menjadi Terlalu Perfeksionis: Menetapkan standar yang sangat tinggi untuk diri sendiri dan orang lain, yang bisa menimbulkan stres.", "Menghindari Konflik untuk Menjaga Harmoni: Mungkin mengorbankan umpan balik yang jujur demi menjaga perasaan.", "Mudah Mengalami Kelelahan Emosional: Menyerap emosi orang-orang di sekitar mereka, yang bisa sangat menguras energi.", "Sulit Menerima Kritik: Karena pekerjaan mereka sangat terkait dengan nilai-nilai pribadi, kritik bisa terasa sangat personal."], leadership: "INFJ memimpin dengan visi dan integritas. Mereka akan fokus pada pengembangan potensi tim dan menciptakan budaya kerja yang positif dan bermakna. Mereka akan mendorong standar layanan pelanggan yang luar biasa yang didasarkan pada hubungan otentik.", profession: "Konselor, Psikolog, Penulis, Guru, Pekerja Sosial, Seniman, Manajer Nirlaba." }, INTJ: { description: "Pemikir strategis dengan rencana untuk segala hal. INTJ adalah individu yang analitis, logis, dan sangat mandiri. Mereka memiliki dorongan kuat untuk menyempurnakan sistem dan proses, selalu mencari cara baru untuk meningkatkan efisiensi dan pengetahuan.", strengths: ["Berpikir Strategis Jangka Panjang: Mampu merencanakan pertumbuhan toko dan mengantisipasi tren pasar.", "Sangat Logis dan Analitis: Unggul dalam menganalisis data penjualan, mengelola anggaran, dan mengoptimalkan inventaris.", "Mandiri dan Percaya Diri: Mampu membuat keputusan sulit secara objektif tanpa dipengaruhi oleh emosi.", "Dorongan untuk Perbaikan: Selalu mencari cara untuk membuat operasional toko lebih efisien dan efektif."], development: ["Bisa Terlihat Arogan atau Tidak Sabaran: Mungkin meremehkan orang-orang yang tidak secepat mereka dalam memahami konsep.", "Kurang Memperhatikan Aspek Emosional: Cenderung mengabaikan 'sentuhan pribadi' yang penting dalam layanan pelanggan dan manajemen tim.", "Perfeksionis yang Berlebihan: Bisa terjebak dalam analisis dan perencanaan, menunda tindakan nyata.", "Menolak Struktur dan Aturan yang Ada: Tidak suka dibatasi oleh aturan jika mereka merasa ada cara yang lebih baik."], leadership: "INTJ adalah pemimpin visioner yang fokus pada efisiensi dan kompetensi. Mereka akan unggul dalam mengoptimalkan tata letak toko, menganalisis metrik kinerja, dan menerapkan strategi inovatif untuk meningkatkan keuntungan. Mereka membangun tim yang kompeten dan menghargai kemandirian.", profession: "Ilmuwan, Insinyur, Pengacara, Konsultan, Perencana Strategis, Manajer Proyek." }, ISTP: { description: "Pragmatis dan logis, ISTP adalah pemecah masalah yang handal. Mereka berkembang dalam situasi yang membutuhkan tindakan cepat dan solusi praktis. Mereka adalah pengamat yang tajam, mampu menganalisis masalah dengan tenang dan menemukan solusi yang efisien.", strengths: ["Sangat Adaptif: Mudah menyesuaikan diri dengan situasi baru dan tidak panik di bawah tekanan.", "Efisien dalam Krisis: Mampu tetap tenang dan logis untuk menemukan solusi tercepat saat terjadi masalah.", "Keterampilan Praktis: Sangat baik dalam pekerjaan yang membutuhkan tangan terampil dan pemahaman mekanis.", "Realistis: Berpijak pada kenyataan dan tidak mudah terpengaruh oleh teori yang tidak praktis."], development: ["Kurang Peka: Bisa secara tidak sengaja mengabaikan perasaan orang lain karena fokus pada fakta.", "Sulit Berkomitmen Jangka Panjang: Cenderung mudah bosan dengan rutinitas dan lebih menyukai tantangan baru.", "Cenderung Tertutup: Tidak suka berbagi pemikiran atau perasaan pribadi mereka.", "Mengambil Risiko yang Tidak Perlu: Terkadang bertindak impulsif tanpa mempertimbangkan konsekuensi jangka panjang."], leadership: "ISTP memimpin dengan contoh praktis. Mereka akan menjadi orang yang turun tangan langsung untuk memperbaiki masalah operasional. Mereka memberikan kebebasan kepada tim mereka untuk bekerja, selama hasilnya efisien dan efektif.", profession: "Teknisi, Pilot, Ahli Forensik, Programmer, Insinyur, Entrepreneur." }, ISFP: { description: "Artistik, menawan, dan cinta damai, ISFP hidup di saat ini dan menikmati lingkungan mereka dengan kelima indera mereka. Mereka fleksibel, spontan, dan biasanya pendiam, tetapi memiliki kehangatan batin dan antusiasme yang mereka bagikan dengan orang-orang terdekat.", strengths: ["Sangat Peka Estetika: Mampu menciptakan lingkungan toko yang menarik secara visual dan nyaman.", "Fleksibel dan Spontan: Mudah beradaptasi dengan perubahan kebutuhan pelanggan atau dinamika tim.", "Setia dan Peduli: Membangun hubungan pribadi yang kuat dengan staf dan pelanggan setia.", "Praktis dan Realistis: Meskipun artistik, mereka tetap berpijak pada apa yang bisa dilakukan saat ini."], development: ["Sangat Menghindari Konflik: Akan melakukan apa saja untuk menghindari konfrontasi, bahkan jika itu berarti masalah tidak terselesaikan.", "Tidak Suka Diatur dengan Ketat: Menolak struktur, jadwal, dan aturan yang kaku.", "Sulit Menerima Kritik: Sangat sensitif dan dapat menganggap umpan balik sebagai serangan pribadi.", "Kurang dalam Perencanaan Jangka Panjang: Fokus pada saat ini membuat mereka sulit untuk merencanakan masa depan."], leadership: "ISFP memimpin dengan menciptakan lingkungan yang positif dan mendukung. Mereka akan fokus pada pengalaman pelanggan, memastikan suasana toko menyenangkan, dan membangun tim yang merasa dihargai secara pribadi.", profession: "Seniman, Desainer, Pekerja Sosial, Konselor, Guru, Chef, Aktor." }, INFP: { description: "Idealis yang puitis, baik hati, dan altruistik, selalu mencari kebaikan bahkan pada orang dan peristiwa terburuk sekalipun. INFP didorong oleh nilai-nilai internal yang kuat dan keinginan untuk membantu orang lain mencapai potensi mereka.", strengths: ["Sangat Berempati: Mampu memahami dan terhubung dengan perasaan staf dan pelanggan secara mendalam.", "Kreatif dan Imajinatif: Menghadirkan ide-ide baru untuk meningkatkan pengalaman di toko.", "Berprinsip dan Setia: Sangat berdedikasi pada nilai-nilai mereka dan pada orang-orang yang mereka pimpin.", "Komunikator yang Menginspirasi: Mampu mengkomunikasikan visi dan nilai-nilai dengan cara yang menyentuh hati."], development: ["Bisa Menjadi Tidak Praktis: Terkadang ide-ide mereka terlalu idealis dan sulit untuk diimplementasikan.", "Terlalu Kritis pada Diri Sendiri: Menetapkan standar moral yang sangat tinggi dan bisa kecewa jika kenyataan tidak sesuai.", "Sangat Menghindari Konflik: Tidak suka berurusan dengan data yang keras atau membuat keputusan yang mungkin menyakiti perasaan seseorang.", "Sulit Menerima Kenyataan Pahit: Bisa merasa kewalahan oleh aspek-aspek bisnis yang keras seperti pemecatan atau persaingan."], leadership: "INFP memimpin dengan nilai-nilai dan inspirasi. Mereka akan membangun budaya perusahaan yang kuat yang berpusat pada pelayanan dan pengembangan diri. Mereka memotivasi tim dengan tujuan yang lebih besar daripada sekadar penjualan.", profession: "Penulis, Konselor, Psikolog, Pengajar, Seniman, Pekerja Sosial." }, INTP: { description: "Penemu yang inovatif dengan dahaga yang tak terpuaskan akan pengetahuan. INTP adalah pemikir logis yang menghabiskan banyak waktu dalam pikiran mereka sendiri, mengeksplorasi konsep, menganalisis teori, dan menciptakan solusi yang cerdik.", strengths: ["Sangat Logis dan Analitis: Mampu menganalisis masalah kompleks dan menemukan akar penyebabnya.", "Imajinatif dan Orisinal: Menghasilkan solusi dan ide-ide yang tidak terpikirkan oleh orang lain.", "Objektif dan Terbuka: Bersedia mendengarkan semua sudut pandang untuk menemukan kebenaran.", "Tenang dan Fleksibel: Tidak mudah stres dan dapat beradaptasi dengan informasi baru."], development: ["Kurang Peka secara Sosial: Bisa terlihat acuh tak acuh atau jauh karena mereka hidup di dalam pikiran mereka.", "Sering Menunda-nunda: Mungkin menghabiskan terlalu banyak waktu untuk menganalisis dan tidak cukup waktu untuk bertindak.", "Tidak Suka Aturan dan Birokrasi: Merasa terkekang oleh prosedur standar atau tugas-tugas administratif.", "Bisa Menjadi Argumentatif: Suka menunjukkan kelemahan dalam logika orang lain, yang bisa terlihat seperti kritik."], leadership: "INTP memimpin dengan mendorong inovasi dan kompetensi. Mereka akan unggul dalam menganalisis data untuk meningkatkan efisiensi, tetapi mungkin perlu bantuan dalam mengelola aspek antarpribadi tim. Mereka menghargai kecerdasan dan otonomi.", profession: "Ilmuwan, Programmer, Analis Sistem, Pengacara, Profesor, Peneliti." }, ESTP: { description: "Cerdas, energik, dan sangat perseptif, ESTP benar-benar menikmati hidup di ujung tanduk. Mereka adalah orang-orang yang berorientasi pada tindakan, lebih suka terjun langsung dan belajar sambil berjalan daripada menghabiskan waktu dengan teori.", strengths: ["Berani dan Berorientasi Tindakan: Tidak ragu untuk mengambil risiko dan membuat keputusan cepat.", "Sangat Jeli: Mampu memperhatikan detail-detail kecil di lingkungan mereka dan bereaksi dengan cepat.", "Persuasif dan Menawan: Pandai bernegosiasi dan memengaruhi orang lain.", "Fleksibel dan Spontan: Mudah beradaptasi dengan situasi apa pun yang muncul."], development: ["Tidak Sabaran: Ingin melihat hasil segera dan bisa frustrasi dengan proses yang lambat.", "Kurang Terstruktur: Tidak suka perencanaan jangka panjang dan bisa mengabaikan aturan.", "Cenderung Mengambil Risiko Berlebihan: Antusiasme mereka bisa membawa mereka ke dalam situasi yang berisiko.", "Bisa Menjadi Tidak Sensitif: Mungkin memprioritaskan logika dan kesenangan di atas perasaan orang lain."], leadership: "ESTP adalah pemimpin yang energik dan langsung. Mereka akan berada di lantai penjualan, berinteraksi dengan pelanggan, dan memotivasi tim dengan energi mereka. Mereka hebat dalam situasi krisis dan penjualan yang bergerak cepat.", profession: "Marketing, Sales, Polisi, Entrepreneur, Pialang Saham, Paramedis." }, ESFP: { description: "Spontan, energik, dan antusias â€“ hidup tidak pernah membosankan di sekitar mereka. ESFP adalah entertainer sejati, suka menjadi pusat perhatian dan memastikan semua orang bersenang-senang. Mereka praktis, jeli, dan sangat sosial.", strengths: ["Sangat Sosial dan Ramah: Mampu membuat pelanggan merasa diterima dan membangun semangat tim yang positif.", "Menghibur dan Antusias: Menciptakan suasana toko yang hidup dan menyenangkan.", "Praktis dan Jeli: Mampu melihat apa yang perlu dilakukan saat ini untuk meningkatkan pengalaman pelanggan.", "Adaptif dan Fleksibel: Mudah mengikuti arus dan menangani situasi tak terduga dengan baik."], development: ["Sulit Fokus pada Jangka Panjang: Cenderung menghindari perencanaan dan tugas-tugas administratif yang membosankan.", "Sangat Menghindari Konflik: Lebih suka menjaga hal-hal tetap ringan dan mungkin menghindari percakapan sulit.", "Mudah Bosan: Membutuhkan rangsangan terus-menerus dan bisa kehilangan minat pada rutinitas.", "Sensitif terhadap Kritik: Meskipun terlihat percaya diri, mereka sangat peduli dengan apa yang orang lain pikirkan."], leadership: "ESFP memimpin dengan menciptakan pengalaman. Mereka akan fokus pada layanan pelanggan yang luar biasa, acara di dalam toko, dan membangun tim yang terasa seperti keluarga. Mereka adalah wajah toko yang sempurna.", profession: "Entertainer, Seniman, Marketing, Konselor, Desainer, Pemandu Wisata." }, ENFP: { description: "Semangat bebas yang antusias, kreatif, dan mudah bergaul, yang selalu dapat menemukan alasan untuk tersenyum. ENFP adalah komunikator yang hebat, mampu terhubung dengan orang lain melalui antusiasme dan wawasan mereka yang tajam.", strengths: ["Karismatik dan Antusias: Mampu memotivasi dan menginspirasi tim dan pelanggan dengan energi positif mereka.", "Sangat Kreatif: Selalu memiliki ide-ide baru untuk pemasaran, promosi, dan tata letak toko.", "Komunikator yang Hebat: Pandai memahami orang lain dan mengartikulasikan ide-ide dengan cara yang menarik.", "Fleksibel dan Mudah Beradaptasi: Terbuka terhadap kemungkinan baru dan tidak takut mencoba hal-hal baru."], development: ["Cenderung Tidak Terorganisir: Bisa kesulitan dengan detail, administrasi, dan tindak lanjut.", "Mudah Bosan dan Kehilangan Fokus: Mungkin memulai banyak proyek tetapi kesulitan menyelesaikannya.", "Terlalu Banyak Berjanji: Dalam antusiasme mereka, mereka mungkin setuju untuk melakukan lebih dari yang bisa mereka tangani.", "Sangat Menghindari Konflik: Tidak suka membuat keputusan yang akan membuat orang lain tidak bahagia."], leadership: "ENFP memimpin dengan inspirasi dan kreativitas. Mereka akan menjadi sumber ide dan energi yang tak ada habisnya. Mereka membangun budaya kerja yang positif di mana setiap orang merasa didorong untuk menjadi kreatif dan berkontribusi.", profession: "Motivator, Reporter, Konselor, Psikolog, Pengajar, Aktor." }, ENTP: { description: "Pemikir yang cerdas dan berani yang tidak bisa menolak tantangan intelektual. ENTP suka berdebat, bukan karena mereka agresif, tetapi karena itu adalah cara mereka mengeksplorasi ide dari setiap sudut. Mereka cepat, cerdik, dan inovatif.", strengths: ["Sangat Inovatif: Selalu melihat cara untuk menantang status quo dan meningkatkan sistem yang ada.", "Pandai Berdebat dan Bernegosiasi: Mampu melihat semua sisi argumen dan meyakinkan orang lain.", "Berpengetahuan Luas dan Cepat Belajar: Dapat dengan cepat memahami konsep-konsep baru dan menerapkannya.", "Karismatik dan Energik: Antusiasme mereka terhadap ide-ide baru bisa menular."], development: ["Bisa Menjadi Argumentatif: Terkadang berdebat hanya untuk kesenangan, yang bisa melelahkan orang lain.", "Tidak Fokus pada Detail: Lebih tertarik pada ide besar daripada implementasi sehari-hari.", "Tidak Sabaran dengan Orang yang Lebih Lambat: Bisa frustrasi dengan orang yang tidak bisa mengikuti alur pikiran mereka.", "Menolak Aturan dan Struktur: Tidak suka diberitahu apa yang harus dilakukan dan lebih suka menemukan cara mereka sendiri."], leadership: "ENTP memimpin dengan menantang tim mereka untuk berpikir. Mereka akan terus-menerus mendorong inovasi dalam proses penjualan, pemasaran, dan layanan. Mereka menciptakan lingkungan di mana ide-ide baru didorong dan diperdebatkan.", profession: "Pengacara, Konsultan, Ilmuwan, Aktor, Marketing, Entrepreneur." }, ESTJ: { description: "Administrator yang luar biasa, tak tertandingi dalam mengelola berbagai hal atau orang. ESTJ adalah individu yang praktis, realistis, dan berpegang pada fakta. Mereka memiliki dorongan alami untuk memimpin dan memastikan segala sesuatu berjalan sesuai aturan dan jadwal.", strengths: ["Kepemimpinan yang Kuat dan Tegas: Mampu mengambil alih, mendelegasikan tugas dengan jelas, dan memotivasi tim untuk mencapai hasil.", "Sangat Terorganisir dan Efisien: Ahli dalam membuat rencana, sistem, dan jadwal yang memastikan operasional berjalan lancar.", "Berdedikasi Tinggi dan Andal: Bekerja keras dan tidak akan berhenti sampai pekerjaan selesai sesuai standar.", "Jujur dan Langsung: Memberikan umpan balik yang jelas dan tidak bertele-tele untuk perbaikan kinerja."], development: ["Tidak Fleksibel dan Keras Kepala: Percaya bahwa cara mereka adalah yang terbaik dan sulit menerima sudut pandang atau inovasi baru.", "Kesulitan Mengungkapkan Apresiasi: Mungkin fokus pada apa yang salah daripada mengakui apa yang sudah berjalan dengan baik.", "Cenderung Menghakimi: Cepat menilai sesuatu atau seseorang yang tidak sesuai dengan standar dan aturan mereka.", "Bisa Menjadi Terlalu Dominan: Gaya kepemimpinan mereka bisa terasa mengintimidasi bagi beberapa anggota tim."], leadership: "ESTJ adalah Kepala Toko yang berorientasi pada hasil dan efisiensi. Mereka akan menetapkan target penjualan yang jelas, mengelola staf dengan disiplin, dan memastikan toko berjalan seperti mesin yang diminyaki dengan baik. Mereka unggul dalam operasional, penegakan aturan, dan pencapaian target yang terukur.", profession: "Militer, Manajer, Polisi, Hakim, Pengacara, Guru, Sales, Auditor, Akuntan, System Analyst." }, ESFJ: { description: "Sangat peduli, sosial, dan populer, ESFJ adalah 'Sang Konsul' yang selalu ingin membantu. Mereka adalah pilar komunitas, mengambil peran dalam mengatur acara dan memastikan semua orang bahagia dan diperhatikan. Mereka teliti dan setia.", strengths: ["Membangun Keharmonisan: Sangat baik dalam menciptakan lingkungan kerja yang positif dan kohesif.", "Sangat Terorganisir untuk Orang Lain: Ahli dalam mengatur jadwal dan tugas untuk memastikan kebutuhan tim terpenuhi.", "Praktis dan Dapat Diandalkan: Melaksanakan tugas dengan cermat dan selalu siap membantu.", "Peka terhadap Kebutuhan Orang Lain: Secara alami memperhatikan kapan seseorang membutuhkan bantuan atau dukungan."], development: ["Terlalu Bergantung pada Persetujuan: Nilai diri mereka sangat terikat pada apa yang orang lain pikirkan tentang mereka.", "Sangat Sensitif terhadap Kritik: Sulit menerima umpan balik negatif, bahkan jika itu konstruktif.", "Menghindari Konflik: Akan mengorbankan kebutuhan mereka sendiri atau kebenaran untuk menjaga kedamaian.", "Enggan Berinovasi: Lebih suka mengikuti metode yang telah terbukti berhasil daripada mencoba sesuatu yang baru."], leadership: "ESFJ memimpin dengan dukungan dan perhatian. Mereka akan menjadi jantung tim, memastikan semua orang merasa menjadi bagian dari keluarga. Mereka unggul dalam layanan pelanggan dan membangun loyalitas baik dari staf maupun pelanggan.", profession: "Perawat, Manajer HR, Perencana Acara, Guru, Pekerja Sosial, Administratif." }, ENFJ: { description: "Protagonis yang karismatik dan menginspirasi, mampu memikat pendengarnya. ENFJ adalah pemimpin alami, penuh gairah dan karisma. Mereka sering menjadi panutan, menjangkau dan menginspirasi orang lain untuk mencapai dan melakukan kebaikan di dunia.", strengths: ["Menginspirasi dan Memotivasi: Mampu melihat potensi pada orang lain dan membantu mereka mencapainya.", "Sangat Berempati: Secara tulus peduli pada kesejahteraan tim mereka dan akan bekerja keras untuk membantu mereka.", "Komunikator yang Luar Biasa: Pandai mengartikulasikan visi dan menyatukan orang-orang di belakang tujuan bersama.", "Terorganisir dan Andal: Mampu mengubah visi menjadi rencana yang dapat ditindaklanjuti."], development: ["Bisa Menjadi Terlalu Idealis: Terkadang visi mereka tidak berpijak pada kenyataan.", "Sangat Sensitif terhadap Kritik: Bisa merasa sangat terluka oleh umpan balik negatif.", "Cenderung Mengabaikan Kebutuhan Diri Sendiri: Terlalu fokus pada membantu orang lain sehingga mereka lupa merawat diri sendiri.", "Bisa Menjadi Terlalu Mengontrol: Keinginan mereka untuk membantu bisa berubah menjadi keinginan untuk mengarahkan setiap aspek kehidupan orang lain."], leadership: "ENFJ memimpin dengan karisma dan pengembangan. Mereka akan menjadi mentor bagi tim mereka, mendorong setiap individu untuk tumbuh. Mereka menciptakan budaya kerja yang positif dan berorientasi pada tujuan yang lebih tinggi.", profession: "Konsultan, Pengajar, Manajer SDM, Psikolog, Diplomat, Pemimpin Nirlaba." }, ENTJ: { description: "Pemimpin yang berani, imajinatif, dan berkemauan kuat, selalu menemukan atau menciptakan cara. ENTJ adalah visioner yang didorong untuk mengubah ide menjadi kenyataan. Mereka cepat melihat inefisiensi dan menyusun solusi strategis, serta senang memimpin tim menuju tujuan yang ambisius.", strengths: ["Pemimpin Visioner dan Karismatik: Mampu mengartikulasikan visi yang menarik dan memotivasi tim untuk mencapainya.", "Sangat Strategis dan Logis: Unggul dalam perencanaan bisnis, analisis kompetitif, dan menemukan peluang pertumbuhan.", "Tegas dan Percaya Diri: Tidak ragu untuk mengambil keputusan sulit dan memimpin dari depan.", "Efisien dan Berorientasi pada Tujuan: Fokus pada hasil akhir dan akan mendorong tim untuk mencapai dan melampaui target."], development: ["Bisa Menjadi Tidak Sabaran dan Dominan: Mungkin mengabaikan masukan dari orang lain dan terlihat arogan.", "Tidak Peka terhadap Kebutuhan Emosional Tim: Fokus pada tujuan dapat membuat mereka mengabaikan kesejahteraan emosional staf.", "Sulit Menerima Kegagalan: Sangat kritis terhadap diri sendiri dan orang lain ketika tujuan tidak tercapai.", "Cenderung Berdebat untuk Menang: Bisa mengubah setiap diskusi menjadi sebuah kompetisi, yang dapat melelahkan tim."], leadership: "ENTJ adalah Kepala Toko yang transformasional. Mereka tidak hanya akan mengelola operasional harian, tetapi juga akan terus-menerus mencari cara untuk mengembangkan bisnis, melampaui pesaing, dan melatih tim untuk menjadi yang terbaik. Mereka adalah pemimpin yang menuntut keunggulan dan mendorong inovasi.", profession: "Eksekutif Bisnis, Pengacara, Konsultan, Pemimpin Organisasi, Manajer Proyek, Entrepreneur." }
        };

        let currentQuestionIndex = 0;
        let answers = new Array(questionSets.length).fill({ most: null, least: null });
        let userData = {};

        // Elemen DOM
        const welcomePage = document.getElementById('welcome-page');
        const testPage = document.getElementById('test-page');
        const thankYouPage = document.getElementById('thank-you-page');
        const dataDiriForm = document.getElementById('data-diri-form');
        const startBtn = document.getElementById('start-btn');
        const persetujuanCheckbox = document.getElementById('persetujuan');
        const namaInput = document.getElementById('nama');
        const emailInput = document.getElementById('email');
        const posisiInput = document.getElementById('posisi');
        const questionTitle = document.getElementById('question-title');
        const questionContainer = document.getElementById('question-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const finishBtn = document.getElementById('finish-btn');
        const finishBtnText = document.getElementById('finish-btn-text');
        const finishSpinner = document.getElementById('finish-spinner');
        const progressBar = document.getElementById('progress-bar');
        const validationMessage = document.getElementById('validation-message');
        
        function validateForm() {
            startBtn.disabled = !(namaInput.value && emailInput.value && posisiInput.value && persetujuanCheckbox.checked);
        }
        dataDiriForm.addEventListener('input', validateForm);
        persetujuanCheckbox.addEventListener('change', validateForm);

        dataDiriForm.addEventListener('submit', (e) => {
            e.preventDefault();
            userData = {
                nama: namaInput.value,
                email: emailInput.value,
                posisi: posisiInput.value,
            };
            welcomePage.classList.add('hidden');
            testPage.classList.remove('hidden');
            showQuestion(currentQuestionIndex);
        });

        function showQuestion(index) {
            questionTitle.textContent = `Set Pernyataan ${index + 1} dari ${questionSets.length}`;
            const qSet = questionSets[index];
            questionContainer.innerHTML = ''; // Kosongkan kontainer

            qSet.statements.forEach((stmt, stmtIndex) => {
                const isMost = answers[index].most === stmtIndex;
                const isLeast = answers[index].least === stmtIndex;

                questionContainer.innerHTML += `
                    <div class="statement-card">
                        <span class="text-gray-700">${stmt.text}</span>
                        <div class="flex space-x-2">
                            <button class="btn-choice btn-most ${isMost ? 'selected-most' : ''}" data-q-index="${index}" data-s-index="${stmtIndex}" data-choice="most">Paling Sesuai</button>
                            <button class="btn-choice btn-least ${isLeast ? 'selected-least' : ''}" data-q-index="${index}" data-s-index="${stmtIndex}" data-choice="least">Tidak Sesuai</button>
                        </div>
                    </div>
                `;
            });
            
            addChoiceEventListeners();
            updateNavigation();
            updateProgress();
        }

        function addChoiceEventListeners() {
            document.querySelectorAll('.btn-choice').forEach(button => {
                button.addEventListener('click', (e) => {
                    const qIndex = parseInt(e.target.dataset.qIndex);
                    const sIndex = parseInt(e.target.dataset.sIndex);
                    const choice = e.target.dataset.choice;

                    // Logika untuk memastikan 'most' dan 'least' tidak pada pernyataan yang sama
                    if (choice === 'most') {
                        if (answers[qIndex].least === sIndex) answers[qIndex].least = null; // Batalkan 'least' jika sama
                        answers[qIndex].most = sIndex;
                    } else if (choice === 'least') {
                         if (answers[qIndex].most === sIndex) answers[qIndex].most = null; // Batalkan 'most' jika sama
                        answers[qIndex].least = sIndex;
                    }
                    
                    showQuestion(qIndex); // Render ulang untuk update tampilan tombol
                });
            });
        }

        function updateNavigation() {
            prevBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = currentQuestionIndex === questionSets.length - 1 ? 'none' : 'inline-block';
            finishBtn.style.display = currentQuestionIndex === questionSets.length - 1 ? 'inline-block' : 'none';
        }
        
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questionSets.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function validateCurrentQuestion() {
            const currentAnswer = answers[currentQuestionIndex];
            if (currentAnswer.most === null || currentAnswer.least === null) {
                validationMessage.textContent = 'Harap pilih satu jawaban "Paling Sesuai" dan satu "Tidak Sesuai".';
                validationMessage.classList.remove('hidden');
                return false;
            }
            validationMessage.classList.add('hidden');
            return true;
        }

        nextBtn.addEventListener('click', () => {
            if (!validateCurrentQuestion()) return;

            if (currentQuestionIndex < questionSets.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });

        finishBtn.addEventListener('click', () => {
             if (!validateCurrentQuestion()) return;
            processAndSendResults();
        });

        async function processAndSendResults() {
            finishBtn.disabled = true;
            finishBtnText.textContent = 'Memproses...';
            finishSpinner.classList.remove('hidden');

            calculateResult();
            
            try {
                await sendEmailWithPDF();
                testPage.classList.add('hidden');
                thankYouPage.classList.remove('hidden');
            } catch (error) {
                console.error("Gagal mengirim email:", error);
                validationMessage.textContent = 'Gagal mengirim hasil. Silakan coba lagi atau hubungi administrator.';
                validationMessage.classList.remove('hidden');
                finishBtn.disabled = false;
                finishBtnText.textContent = 'Selesaikan Tes';
                finishSpinner.classList.add('hidden');
            }
        }

        // --- FUNGSI KALKULASI BARU UNTUK METODE PERINGKAT ---
        function calculateResult() {
            let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };

            answers.forEach((answer, index) => {
                const qSet = questionSets[index];
                if (answer.most !== null) {
                    const mostTrait = qSet.statements[answer.most].trait;
                    scores[mostTrait] += 2; // Beri bobot lebih untuk pilihan 'most'
                }
                if (answer.least !== null) {
                    const leastTrait = qSet.statements[answer.least].trait;
                    // Logika kebalikannya: jika paling tidak sesuai I, berarti dia E.
                    const opposite = { E: 'I', I: 'E', S: 'N', N: 'S', T: 'F', F: 'T', J: 'P', P: 'J' };
                    scores[opposite[leastTrait]] += 1;
                }
            });

            let resultType = '';
            resultType += scores.E >= scores.I ? 'E' : 'I';
            resultType += scores.S >= scores.N ? 'S' : 'N';
            resultType += scores.T >= scores.F ? 'T' : 'F';
            resultType += scores.J >= scores.P ? 'J' : 'P';
            
            userData.resultType = resultType;
            userData.scores = scores;
        }

        function generateResultHTML(type) {
            const resultData = allInterpretations[type];
            if (!resultData) return '<h1>Hasil tidak ditemukan</h1>';

            const strengthsHTML = resultData.strengths.map(item => `<li>${item}</li>`).join('');
            const developmentHTML = resultData.development.map(item => `<li>${item}</li>`).join('');
            const scoresHTML = Object.entries(userData.scores).map(([key, value]) => `
                <div style="flex: 1; min-width: 120px; text-align: center; padding: 8px; margin: 4px; background-color: #f3f4f6; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: 700;">${key}</div>
                    <div style="font-size: 1.125rem;">${value}</div>
                </div>
            `).join('');


            return `
                <div style="font-family: 'Inter', sans-serif; padding: 2rem; color: #374151;">
                    <div style="text-align: center;">
                        <h2 style="font-size: 1.5rem; font-weight: 700;">Analisis Detail Hasil Tes Kepribadian</h2>
                        <p style="font-size: 1.125rem; margin-top: 1rem;">Nama: <span style="font-weight: 600;">${userData.nama}</span></p>
                         <p style="font-size: 1.125rem;">Posisi Dilamar: <span style="font-weight: 600;">${userData.posisi}</span></p>
                        <p style="font-size: 1.125rem;">Tipe Kepribadian:</p>
                        <p style="font-size: 2.25rem; font-weight: 700; color: #4f46e5; margin: 1rem 0;">${type}</p>
                    </div>
                    <div style="margin-top: 2rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; border-bottom: 2px solid #c7d2fe; padding-bottom: 0.5rem;">Skor Mentah</h3>
                        <div style="display: flex; flex-wrap: wrap; justify-content: center; margin-top: 0.75rem;">
                           ${scoresHTML}
                        </div>
                    </div>
                    <div style="margin-top: 2rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; border-bottom: 2px solid #c7d2fe; padding-bottom: 0.5rem;">Deskripsi Karakter</h3>
                        <p style="margin-top: 0.75rem; line-height: 1.625;">${resultData.description}</p>
                    </div>
                    <div style="margin-top: 2rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; border-bottom: 2px solid #c7d2fe; padding-bottom: 0.5rem;">Kekuatan Utama</h3>
                        <ul style="margin-top: 0.75rem; list-style-position: inside; padding-left: 1rem;">${strengthsHTML}</ul>
                    </div>
                    <div style="margin-top: 2rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; border-bottom: 2px solid #c7d2fe; padding-bottom: 0.5rem;">Kelemahan & Area Pengembangan</h3>
                        <ul style="margin-top: 0.75rem; list-style-position: inside; padding-left: 1rem;">${developmentHTML}</ul>
                    </div>
                    <div style="margin-top: 2rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; border-bottom: 2px solid #c7d2fe; padding-bottom: 0.5rem;">Gaya Kepemimpinan & Kontribusi di Tempat Kerja</h3>
                        <p style="margin-top: 0.75rem; line-height: 1.625;">${resultData.leadership}</p>
                    </div>
                </div>
            `;
        }
        
        async function sendEmailWithPDF() {
            const { jsPDF } = window.jspdf;
            
            const reportContainer = document.createElement('div');
            reportContainer.style.position = 'absolute';
            reportContainer.style.left = '-9999px';
            reportContainer.style.width = '800px';
            reportContainer.innerHTML = generateResultHTML(userData.resultType);
            document.body.appendChild(reportContainer);

            try {
                const scriptURL = 'https://script.google.com/macros/s/AKfycbx0VvKLGEVRy4auxA-D6uwH40KNR3gOrv4K9huYJowVZSQrLoGZcaRyV0QM-VvIz9zH/exec';
                
                const canvas = await html2canvas(reportContainer, { scale: 2 });
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = imgWidth / imgHeight;
                let widthInPdf = pdfWidth - 20;
                let heightInPdf = widthInPdf / ratio;

                if (heightInPdf > pdfHeight - 20) {
                    heightInPdf = pdfHeight - 20;
                    widthInPdf = heightInPdf * ratio;
                }
                
                const xOffset = (pdfWidth - widthInPdf) / 2;
                const yOffset = 10;

                pdf.addImage(imgData, 'PNG', xOffset, yOffset, widthInPdf, heightInPdf);
                const pdfBase64 = pdf.output('datauristring').split(',')[1];

                const payload = {
                    nama: userData.nama,
                    email: userData.email,
                    posisi: userData.posisi,
                    tipe: userData.resultType,
                    skor: JSON.stringify(userData.scores),
                    pdf: pdfBase64
                };

                await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

            } catch (error) {
                console.error('Error:', error);
                throw error;
            } finally {
                if (document.body.contains(reportContainer)) {
                    document.body.removeChild(reportContainer);
                }
            }
        }
    </script>
</body>
</html>
